# Managed by ansible / markus.meissner@meissner.IT
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
COMMIT
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:17668-server - [0:0]
-A INPUT ! -i lo -s 192.168.7.0/24 -j 17668-server
-A 17668-server -s 192.168.7.0/24 -p tcp -m state --state RELATED,ESTABLISHED -j ACCEPT
-A 17668-server -s 192.168.7.10/32 -p tcp -m tcp --sport 25 -j ACCEPT
{% if inventory_hostname == 'web05.monheim.de' %}
#2019-08-12, mm: EE requested monheim-entdecken.de -> monheimer-kulturwerke.de (web03/web07 -> web05)
-A 17668-server -s 192.168.7.18/32 -p tcp --dport 443 -j ACCEPT
-A 17668-server -s 192.168.7.21/32 -p tcp --dport 443 -j ACCEPT
-A 17668-server -s 192.168.7.42/32 -p tcp --dport 443 -j ACCEPT
-A 17668-server -s 192.168.7.44/32 -p tcp --dport 22 -j ACCEPT
{% endif %}
{% if inventory_hostname == 'web07.monheim.de' %}
#2019-09-09, mm: www.monheim-entdecken.de -> www.monheim.de (web03/web05 -> web07)
-A 17668-server -s 192.168.7.13/32 -p tcp -m multiport --dports 443 -j ACCEPT
-A 17668-server -s 192.168.7.18/32 -p tcp -m multiport --dports 80,443 -j ACCEPT
-A 17668-server -s 192.168.7.21/32 -p tcp -m multiport --dports 80,443 -j ACCEPT
# web06 -> web07
-A 17668-server -s 192.168.7.27/32 -p tcp -m tcp --dport 443 -j ACCEPT
-A 17668-server -s 192.168.7.44/32 -p tcp --dport 22 -j ACCEPT
{% endif %}
{% if inventory_hostname in ('web08.monheim.intern', 'web09.monheim.intern') %}
#2021-10-15: Allow web05 as jump host for darinir
-A 17668-server -s 192.168.7.13/32 -p tcp --dport 22 -j ACCEPT
{% endif %}
{% if inventory_hostname == 'schildweb.monheim.intern' %}
#19956: Zugriff von pcs01 auf schildweb
-A 17668-server -s 192.168.7.37/32 -p tcp -m multiport --dports 80,443 -j ACCEPT
{% endif %}
{% if inventory_hostname == 'session.monheim.intern' %}
# git01 -> session
-A 17668-server -s 192.168.7.44/32 -p tcp --dport 22 -j ACCEPT
{% endif %}
-A 17668-server -d 192.168.7.255/32 -j REJECT --reject-with icmp-port-unreachable
-A 17668-server -j LOG --log-prefix "17668-server#1 "
-A 17668-server -j REJECT --reject-with icmp-port-unreachable
COMMIT

